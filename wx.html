<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>打开微信支付</title>
<style>
  body{font-family:Arial,Helvetica,sans-serif;padding:24px;text-align:center}
  .btn{display:inline-block;padding:14px 20px;border:1px solid #ccc;border-radius:10px;text-decoration:none;margin-top:20vh}
  code{background:#f6f7f9;padding:2px 6px;border-radius:4px;display:block;margin-top:16px}
</style>
</head>
<body>
<a id="btn" class="btn" href="#">打开微信支付（点我）</a>
<code id="preview"></code>

<script>
(function(){
  function getParam(k){var m=location.search.match(new RegExp('[?&]'+k+'=([^&]+)'));return m?decodeURIComponent(m[1]):'';}
  var u = getParam('u');
  var a = document.getElementById('btn');
  var p = document.getElementById('preview');
  p.textContent = u ? u : '未检测到 ?u= 参数（需URL编码的 weixin:// 链接）';
  if(u){
    // 关键：直接把 href 设为 scheme，让“用户点击超链接”来触发
    a.setAttribute('href', u);
    a.setAttribute('target', '_self'); // 避免新窗口
    // 兜底：同时在点击时再尝试一次 location（有些内核需要）
    a.addEventListener('click', function(e){
      // 不阻止默认，先让 <a> 自己跳。如果失败，下面的 setTimeout 再补一次。
      setTimeout(function(){ try{location.href=u;}catch(e){} }, 50);
    });
  }else{
    a.removeAttribute('href');
    a.onclick=function(e){e.preventDefault();alert('缺少 ?u= 参数');};
  }
})();
</script>
</body>
</html>
